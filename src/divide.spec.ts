import bigDecimal from "./big-decimal";
const divide = bigDecimal.divide;

describe("divide", function () {
  it("test failing scenario", function () {
    expect(divide("509365950.27576", "0.003802940215600348", 16)).toBe(
      "133940036234.6609666927392804"
    );
  });
  it("STRESS TEST - should return correct result", function () {
    let count = 10000,
      err = 0;
    while (count-- > 0) {
      let dividend: any = (
        Math.random() * Math.pow(10, Math.floor(Math.random() * 10))
      ).toFixed(5);
      let divisor: any =
        Math.random() * Math.pow(10, Math.floor(Math.random() * 10));
      if (divisor == 0) {
        count++;
        continue;
      }
      let jsOut = dividend / divisor;
      let myOut = parseFloat(
        divide(dividend.toString(), divisor.toString(), 5)
      );
      if (isNaN(myOut) || Math.abs(jsOut - myOut) > 0.00001) { // Should account for JS rounding errors and float precision error
        console.log(`Error of ${Math.abs(jsOut - myOut)}`);
        console.log(`${dividend}/${divisor} = ${jsOut} != ${myOut}`);
        err++;
      } else {
        //console.log(`${dividend}/${divisor} = ${jsOut} == ${myOut}`);
      }
    }
    const successRate = (10000 - err)/10000;
    expect(successRate).toBeGreaterThanOrEqual(0.9999);
    // expect(err).toBe(0);
  });
  it("should do basic integer division", function () {
    expect(divide(1234, 12, 2)).toBe("102.83");
  });
  it("should do basic floating point division", function () {
    expect(divide(12.34, 12, 2)).toBe("1.03");
  });
  it("should do basic floating point division", function () {
    expect(divide(29629629362962961839.48344234, 12345678901234567890, 2)).toBe(
      "2.40"
    );
  });
  it("should do basic floating point division", function () {
    expect(
      divide(
        "296296293629629614563475463462345345235412412341235436563456829629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683939296296293629629614563475463462345345235412412341235436563456829629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683939.48344234",
        "1000",
        10
      )
    ).toBe(
      "296296293629629614563475463462345345235412412341235436563456829629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683939296296293629629614563475463462345345235412412341235436563456829629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683929629629362962961456347546346234534523541241234123543656345683.9394834423"
    );
  });
  it("should do basic floating point division", function () {
    expect(divide(45, -4, 2)).toBe("-11.25");
  });
  it("should do basic floating point division", function () {
    expect(divide(-45, -4, 2)).toBe("11.25");
  });
  it("1 / 25 = 0.04", function () {
    expect(divide("1", "25", 2)).toBe("0.04");
  });
  it("-1 / 25 = -0.04", function () {
    expect(divide("-1", "25", 2)).toBe("-0.04");
  });
  it("1 / -25 = -0.04", function () {
    expect(divide("1", "-25", 2)).toBe("-0.04");
  });
  it("-1 / -25 = 0.04", function () {
    expect(divide("-1", "-25", 2)).toBe("0.04");
  });
  it("-1 / -1 = 1", function () {
    expect(divide("-1", "-1", 0)).toBe("1");
  });
  it("10.8 / 10 = 1.08", function () {
    expect(divide("10.8", "10")).toBe("1.08000000");
  });
  it("10.8 / 100 = 0.108", function () {
    expect(divide("10.8", "100")).toBe("0.10800000");
  });
  it("10.8 / 1000 = 0.0108", function () {
    expect(divide("10.8", "1000")).toBe("0.01080000");
  });
  it("10.8 / 10000 = 0.00108", function () {
    expect(divide("10.8", "10000")).toBe("0.00108000");
  });
  it("2.00 / 0.5 = 4.00", function () {
    expect(divide("2.00", "0.5", 2)).toBe("4.00");
  });
  it("0.11005 / 0.1 = 1.1005", function () {
    expect(divide("0.11005", "0.1", 4)).toBe("1.1005");
  });
  it("123456789.123456 / .0123456 = 10000063919.40902022", function () {
    expect(divide("123456789.123456", ".0123456")).toBe("10000063919.40902022");
  });
  it(".102 / .0383292 = 2.66115651", function () {
    expect(divide(".102", ".0383292", 8)).toBe("2.66115651");
  });
  it("divide(0, 2, 3) should add trailing 0s", function () {
    expect(divide(0, 2, 3)).toBe("0.000");
  });
});
